<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Phishing Detection Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
    body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background-color: #f5f5f5;
    }
    .container {
        background-color: #fff;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
        color: #333;
        text-align: center;
    }
    p {
        text-align: center;
        color: #444;
    }
    textarea {
        width: 100%;
        height: 200px;
        padding: 10px;
        margin: 20px 0;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
        resize: vertical;
    }
    button {
        display: block;
        background-color: #007bff;
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin: 0 auto;
    }
    button:hover {
        background-color: #0056b3;
    }
    .result {
        margin-top: 25px;
        padding: 15px;
        background-color: #e7f3ff;
        border-radius: 5px;
        display: none;
        white-space: pre-wrap;
        overflow-x: auto;
    }
    </style>
</head>

<body>
    <div class="container">
    <h1>Phishing Detection Dashboard</h1>
    <p>Paste suspicious email content below for analysis:</p>

    <form id="analyzeForm">
        <textarea id="emailContent" placeholder="Paste email headers or content here..."></textarea>
        <button type="button" id="loadSample" style="margin-bottom:10px;">Load Sample Email</button>
        <button type="submit">Analyze Email</button>
    </form>

    <div id="result" class="result"></div>
    </div>

    <script>
    // Handle form submission
    document.getElementById('analyzeForm').addEventListener('submit', function (e) {
        e.preventDefault();
        const content = document.getElementById('emailContent').value.trim();
        const resultDiv = document.getElementById('result');
        resultDiv.style.display = 'block';
        resultDiv.textContent = 'Analyzing... please wait.';

        fetch('/analyze', {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'email_content=' + encodeURIComponent(content)
        })
        .then(r => r.json())
        .then(data => {
        const reasons = (data.analysis?.reasons || []).map(r => `<li>${r}</li>`).join("");
        resultDiv.innerHTML = `
            <h3>Threat Level: ${data.analysis?.level} (score ${data.analysis?.score})</h3>
            <p><strong>From:</strong> ${data.sender || '(unknown)'}<br>
                <strong>Subject:</strong> ${data.subject || '(none)'}</p>
            <p><strong>URLs checked:</strong> ${data.urls_checked?.join(', ') || 'none'}</p>
            <ul>${reasons}</ul>
        `;
        const pre = document.createElement('pre');
        pre.textContent = JSON.stringify(data, null, 2);
        resultDiv.appendChild(pre);
        })
        .catch(() => {
        resultDiv.style.display = 'block';
        resultDiv.textContent = 'Error analyzing email. Check your server logs.';
        });
    });
    document.getElementById('loadSample').addEventListener('click', () => {
    const sample = `From: "PayPal Security" <support@secure-paypal-alerts.com>
Subject: Urgent: Verify your account now

Dear user,
We have suspended your account due to unusual activity. To avoid a permanent ban, verify your password immediately:

https://secure-paypal-alerts.com/login-check
https://example.com/help/account

Please login within 24 hours to prevent suspension. Click here to verify.`;
    document.getElementById('emailContent').value = sample;
});

    </script>
</body>
</html>
